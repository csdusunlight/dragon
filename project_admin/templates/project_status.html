{% extends "project_base.html" %} {%load staticfiles%} {% block js %}
<script type="text/javascript" src="{%static 'js/ajaxfileupload.js'%}"></script>
<script type="text/javascript">
	$.ajaxSetup({
		data: {
			csrfmiddlewaretoken: '{{ csrf_token }}'
		},
	});
	var data = '<table width="100%"><tr><th>项目编号</th><th>结项项日期</th><th>项目名称</th>' +
		'<th>预计代收/待消耗</th><th>预计总消耗</th><th>总返现金额</th><th>预估渠道消耗</th><th>渠道返现金额</th><th>预估网站消耗</th><th>网站消耗金额</th><th>项目状态</th>' +
		'</tr>[results]<tr id="parent{id}"><td>{id}</td><td>{time}</td><td>{name}</td>' +
		'<td>{topay_amount}</td><td>{paid_amount}</td><td>{consume_amount}</td><td>{topay_amount}</td><td>{return_amount}</td><td>{profit}</td>' +
		'<td>{state_des}</td><td>{state_des}</td></tr>[/results]</table>';
	var url = "/project/projects/" + "?page={page}";
	var url2 = "/project/projects/";
	
	
	
	
	
	$(document).ready(function() {
		$("li.home15").addClass("show-project").toggleClass("on");
		$("li.home2").toggleClass("show");
		$(".Tin-table tr:even").css("background-color", "#fcfcfc");
		
		
		$("#pagedata").ajaxPage({
			url: url,
			pageId: $("#page"),
			run: true,
			content: data,
		});
		
		
		
		
		
		$("#search").click(function() {			//搜索项目数据
			var newurl = url;
			
			created_time_start = $("#created_time_start").val();
			created_time_end = $("#created_time_end").val();
			project_name = $("#project_name").val();
			contact_person = $("#contact_person").val();
			project_num = $("#project_num").val();
			project_status = $("#project_status").val();
			
			if(created_time_start) {
				newurl += "&dateft_0=" + created_time_start;
			}
			if(created_time_end) {
				newurl += "&dateft_1=" + created_time_end;
			}
			if(project_name) {
				newurl += "&name__contains=" + project_name;
			}
			if(contact_person) {
				newurl += "&contact=" + contact_person;
			}
			if(project_num) {
				newurl += "&uuid=" + project_num;
			}
			if(project_status && project_status != 0) {
				newurl += "&state=" + project_status;
			}
			console.log(newurl);
			
			var newdata = data;
			$("#page").empty();
			$("#pagedata").ajaxPage({
				url: newurl,
				pageId: $("#page"),
				run: true,
				content: newdata,
			});
		});
		
		$("#export").click(function() {			//导出表格
			created_time_start = $("#created_time_start").val();
			created_time_end = $("#created_time_end").val();
			project_name = $("#project_name").val();
			contact_person = $("#contact_person").val();
			project_num = $("#project_num").val();
			project_status = $("#project_status").val();
			
			var html = '<form action="' + "{% url 'export_finance_excel' %}" + '" method="get" target="_self" id="postData_form">';
			
			if(created_time_start) {
				html += '<input name="created_time_start" type="hidden" value="' + created_time_start + '"/>';
			}
			if(created_time_end) {
				html += '<input name="created_time_end" type="hidden" value="' + created_time_end + '"/>';
			}
			
			if(project_name) {
				html += '<input name="project_name" type="hidden" value="' + project_name + '"/>';
			}
			
			if(contact_person) {
				html += '<input name="contact_person" type="hidden" value="' + contact_person + '"/>';
			}
			
			if(project_num) {
				html += '<input name="project_num" type="hidden" value="' + project_num + '"/>';
			}
			if(project_status) {
				html += '<input name="project_status" type="hidden" value="' + project_status + '"/>';
			}
			
			html += '</form>';
			var iframe = document.getElementById('myIFrame');
			iframe.contentWindow.document.open();
			iframe.contentWindow.document.write(html);
			iframe.contentWindow.document.close();
			document.getElementById('myIFrame').contentWindow.document.getElementById('postData_form').submit();
		});
		
		

	});
</script>
{% endblock js %} {% block right %}
<div class="Criteria">
	<span>搜索条件</span>
	<div class="Crite-box">
		<form>
			<table width="100%">
				<tr>
					<td>
						<i>立项开始日期：</i>
						<input id="created_time_start" type="date" />
					</td>
					<td>
						<i>立项结束日期：</i>
						<input id="created_time_end" type="date" />
					</td>
					<td>
						<i style="letter-spacing:4.8px;">项目编号：</i>
						<input id="project_num" type="text" />
					</td>
					<td>
						<i style="letter-spacing:4.8px;">项目名称：</i>
						<input id="project_name" type="text" />
					</td>
				</tr>
				<tr>
					<td>
						<i style="letter-spacing:4.8px;">项目状态</i>
						<select name="selectAge" id="project_status">
							<option value="0">全部</option>
							<option value="start">正在进行</option>
							<option value="finish">已结项</option>
						</select>
					</td>
				</tr>
				
			</table>
			<div class="Submit-in">
				<input id="search" type="button" value="搜索" />
				<input id="export" type="button" value="导出" />
			</div>
		</form>
	</div>
</div>

<div class="Tin-table">
	<div id="pagedata">
	</div>
	<div class="Page-in-admin">
		<div class="page" id="page">
		</div>
	</div>
</div>
{%endblock%} {% block modal %}

<!--end-->
{% endblock modal %}