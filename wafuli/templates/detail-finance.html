{% load staticfiles %}
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>{{news.seo_title}}</title>
<meta name="keywords" content="{{news.seo_keywords}}" />
<meta name="description" content="{{news.seo_description}}" />
<link href="{% static 'images/favicon.ico'%}" rel="shortcut icon"/>
<link rel="stylesheet" type="text/css" href="{% static 'css/common.css' %}" />
<link rel="stylesheet" href="{% static 'css/bootstrap.min.css' %}">
<link rel="stylesheet" type="text/css" href="{% static 'css/style.css' %}" />
<link rel="stylesheet" type="text/css" href="{% static 'css/default.css' %}" />
<link rel="stylesheet" type="text/css" href="{% static 'css/component.css' %}" />
<link rel="stylesheet" type="text/css" href="{% static 'css/welfare.css' %}" />
<script type="text/javascript" src="{% static 'js/jquery-1.11.2.min.js' %}"></script>
<script type="text/javascript" src="{% static 'js/bootstrap.min.js' %}"></script>
<script type="text/javascript">
	$.ajaxSetup({
	    data: {csrfmiddlewaretoken: '{{ csrf_token }}' },
	});
	var this_url = window.location.href;
	var id = '{{news.id}}'
	var type = '{{type}}'
	{%if news.isonMobile %}
	var ismobile = true;
	{%else%}
	var ismobile = false;
	var url_openwindow = "{% url 'exp_welfare_openwindow' %}";
	{%endif%}
	$(function(){
		var ahref = $("a.login").attr("href");
		ahref += "?next="+this_url;
		$("a.login").attr("href",ahref);
		$("button.te-mo").click(function(){
			if(ismobile){
				$.ajax({
					url:"{%url 'exp_welfare_erweima' %}?id=" + id + "&type=" + type,
					dataType:"json",
					success:function(ret){
						if(ret.code==0){
							alert("请先登录！")
							window.location.href = ret.url;
						}
						else if(ret.code==1){
							$('img#erweima').attr('src',ret.url);
							$('#myReModal').modal();
						}
					},
					error:function(){
						alert("请检查网络连接");
					}
				});
			}
			else {
				window.open(url_openwindow + "?id=" + id + "&type=" + type);
			}

		});
		$("button.td-tj").click(function(){
			var telnum = $('input#telnum').val();
			telnum = telnum.replace(/(^\s*)|(\s*$)/g, "");
			$('input#telnum').val(telnum);
			var remark = $('input#remark').val();
			var re=/^1[1,2,3,4,6,5,7,8,9]\d{9}$/;
			if(!re.test(telnum)){
				alert("手机号格式不正确！")
				return;
			}
			// var amount = parseFloat($('input#amount').val());
      var amount = $('input#amount').val();
      var re_amount=/^\d+(\.\d+)?$/;
			if(!re_amount.test(amount)){
				alert("投资金额不能为空且必须为纯数字格式！")
				return;
			}
			var term = $('input#term').val();
			if(!re_amount.test(term)){
				alert("投资标期不能为空且必须为纯数字格式！")
				return;
			}
			$('#myModal').modal();
		});
		$("a#confirm").click(function(){
			var telnum = $('input#telnum').val();
			var remark = $('input#remark').val();
			var amount = parseFloat($('input#amount').val());
			var term = $('input#term').val();
			$('#myModal').modal("hide");
			$.ajax({
				url:"{%url 'expsubmit_finance' %}",
				type:'post',
				async:false,
				data:{
					type:type,
					id:id,
					term:term,
					telnum:telnum,
					remark:remark,
					amount: amount
				},
				dataType:"json",
				success:function(ret){
					if(ret.code==0){
						alert("请先登录！")
						window.location.href = ret.url;
					}
					else {
						alert(ret.msg);
					}
				},
				error:function(){
					alert("请检查网络连接");
				}
			});
		});

    // 理财介绍超出隐藏
    var text_box = document.getElementById("text_box"),
        intro = document.getElementById("intro");
    var box_height = text_box.offsetHeight - intro.offsetHeight;
    if(box_height<0){
        var oTitle = null;
        var sTitle = null;

        text_box.setAttribute("class","text-box toolong");

        intro.onmouseover = function(ev) {
          this.title = this.innerHTML;
          sTitle = this.title;
          this.title = '';
          oTitle = document.createElement('div');
          oTitle.className = 'titleShow';
          oTitle.innerHTML = sTitle;
          document.body.appendChild(oTitle);
        };
        intro.onmousemove = function(ev) {
          var ev = ev || window.event;
          oTitle.style.left = ev.clientX + 10 + 'px'; //获取鼠标所在x座标并增加10个像素,下同
          oTitle.style.top = ev.clientY + 10 + 'px';
        }
        intro.onmouseout = function() {
          document.body.removeChild(oTitle);
        }
    }

	});

    // 理财信息登记部分
  var popupShow = function() {
      $(".popup-box").addClass("in");
  }
  var popupHide = function(){
    $(".popup-box").removeClass("in");
  }
</script>
</head>
<body>
 {% include "header.html" %}
<div id="content">
  <p>当前位置：<span><a href="{% url 'index' %}">挖福利</a> > <a href="{{news.get_type_url}}">{{news.get_type}}</a>
   > <a href="">{{news.title}}</a></span></p>
  <div class="finance-top">
    <div class="finance-info">
        <img src="{{news.pic.url}}" />
        <p class="finance-mark">
          <b>{{news.title}}</b>
         {% for mark in news.marks.all|slice:":3" %}
          	<span>{{mark.name}}</span>
         {% endfor %}
        </p>
        <div id="text_box" class="text-box">
          <p id="intro" class="introduction">{{news.introduction}}</p>
        </div>
        <div class="taste-btn">
          {% if not news.is_expired %}
          <button class="md-trigger te-mo">立即投资</button>
          {% else %}
          <button class="te-moe">已结束</button>
          {% endif %}
          <button id="infor_register" onclick="popupShow()">信息登记</button>
        </div>
    </div>
    <div class="finance-bg">
    	<p><span>平台背景</span><span>{{news.background}}</span></p>
		<p><span>注册资本</span><span>{{news.regcap}}</span></p>
		<p><span>上线时间</span><span>{{news.onlinedate}}</span></p>
		<p><span>银行存管机构</span><span>{{news.depository}}</span></p>
		<p><span>ICP号</span><span>{{news.ICP}}</span></p>
    </div>
  </div>

  <div class="td-msgs finance-table">
      <div class="table-head">
          <span>投资金额</span><span>投资期限</span><span>挖福利返现</span><span>预计年化收益</span>
      </div>
      {%for row in table %}
      <div class="table-list">
	      {%for column in row %}<span>{{column}}</span>{%endfor%}
      </div>
      {%endfor%}
  </div>
  <div class="popup-box popup-box-02">
    <div class="td-msg popup-content finance-popup">
      <div class="ma-div">注册手机号：<input type="text" placeholder="输入您的手机号，若有多个请分别提交" class="ms-input" id="telnum"></div>
      <div class="ma-div">投资金额：<input type="text" placeholder="输入您的投资金额（仅限数字）" class="ms-input" id="amount"><span style="position: absolute;line-height: 40px;margin-left: 10px;">元</span></div>
      <div class="ma-div">投资标期：<input type="text" placeholder="输入您的投资标期（仅限数字）" class="ms-input" id="term"><span style="position: absolute;line-height: 40px;margin-left: 10px;">天</span></div>
      <div class="ma-div3">备注：<input type="text" placeholder="可不填" class="ms-input" id="remark"></div>
      <p class="td-yy"><button class="finance-cancel" onclick="popupHide()">取消</button><button class="md-trigger td-tj">提交</button></p>
      <div class="clearboth"></div>
    </div>
  </div>

   <div class="td-msgs">
  	<div class="msg-ti"><img src="{% static 'images/task-04.png' %}" class="ms-pd"/><span class="mag-pp">投资流程</span></div>
    <div class="detail-html">{{news.strategy|safe}}</div>
  </div>

  <div class="td-msgs">
     <div class="msg-ti"><img src="{% static 'images/task-03.png' %}" class="ms-pd"/><span class="mag-pp">注意事项</span></div>
     <div class="detail-html">{{news.rules|safe}}</div>
  </div>

  <div class="td-msgs others">
      <div class="msg-ti"><span class="mag-pp">其他福利</span></div>
      {%for wel in other_wel_list%}
      <a href="{{wel.url}}" class="hy-p">{{wel.title}}</a>
      {%endfor%}
  </div>

  <div class="td-msgs">
  <div class="msg-ti"><img src="{% static 'images/task-05.png' %}" class="ms-pd"/><span class="mag-pp">温馨提示</span></div>
      <p class="hy-p">1、请您务必按照“投资流程”操作，并在完成后返回本页面提交相关数据，以便进行审核与发放相应福利；</p>
      <p class="hy-p">2、福币可在个人中心以100：1的比例兑换成现金并提现至支付宝账户；</p>
      <p class="hy-p">3、挖福利尽最大可能的提供最优质的理财渠道、筛选有诚信的合作平台，但是挖福利不对合作平台提供任何的风险担保；</p>
      <p class="hy-p">如有疑问请联系在线客服或拨打服务热线：0731-85586375</p>
</div>

  <div style="clear:both"></div>
 <!--底部-->
  {% include "footer.html" %}
  <!--浮动窗口-->
  {% include "outline.html" %}


  <!--//体验-->
      <div class="modal fade" id="myReModal">
          <div class="modal-dialog modal-mg">
            <div class="modal-content">
            <div>
                <p style="color:#F08619;font-size:16px;margin:2em 0px 0em 0px;">本项目仅限手机端体验，请用手机扫描二维码进行体验</p>
                <img id='erweima' src="#" style="margin:2em 0px 3em 0px;"/>
            </div>
                </div>
              </div>
        </div>

      <div class="modal fade" id="myModal">
          <div class="modal-dialog modal-mg">
            <div class="modal-content">
             <div class="md-content">
				<div>
					<p style="color:#04B3FF;font-size:25px;">温馨提示</p>
					<p style="padding: 0px 0px 30px 0px;">内容提交后不可更改,提交别人的信息会冻结账户,请谨慎确认</p>
                    <a id="confirm" class="submit_mores">确认</a>
                    <a id="cancel" class="submit_mores" class="close" data-dismiss="modal" aria-label="Close">取消</a>
				</div>
			</div>
				</div><!-- modal-body-->

                </div>
       </div>

</body>
</html>
